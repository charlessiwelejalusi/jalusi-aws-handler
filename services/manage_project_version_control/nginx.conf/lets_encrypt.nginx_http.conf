# Multi-Subdomain Nginx Configuration for Let's Encrypt SSL Setup
# HTTP-only configuration that facilitates Let's Encrypt certificate generation
# This configuration should be used BEFORE SSL certificates are obtained
# After SSL setup, switch to nginx_https.conf
# Supports subdomain-based routing to different services
# - agritech.jalusitech.co.za -> http://127.0.0.1:5001/
# - esdt.jalusitech.co.za -> http://127.0.0.1:5002/
# - jalusi-beauty.jalusitech.co.za -> http://127.0.0.1:5003/
# - jalusi-cms.jalusitech.co.za -> http://127.0.0.1:5004/
# - jalusi-tech.jalusitech.co.za -> http://127.0.0.1:5005/
# - mzansi-serve.jalusitech.co.za -> http://127.0.0.1:5006/

# Global settings
gzip on;
gzip_vary on;
gzip_min_length 1024;
gzip_proxied any;
gzip_comp_level 6;
gzip_types
    text/plain
    text/css
    text/xml
    text/javascript
    application/json
    application/javascript
    application/xml+rss
    application/atom+xml
    image/svg+xml;

# ============================================================================
# Server Block 1: Agritech Subdomain - Let's Encrypt Setup
# Handles requests to agritech.jalusitech.co.za
# Routes to backend service on port 5001
# ============================================================================
server {
    listen 80;
    server_name agritech.jalusitech.co.za;

    # Allow larger uploads through the proxy
    client_max_body_size 500M;

    # Serve ACME HTTP-01 challenges from shared webroot for Let's Encrypt
    # This location MUST be present for Let's Encrypt to verify domain ownership
    location ^~ /.well-known/acme-challenge/ {
        root /var/www/certbot;
        default_type "text/plain";
        try_files $uri =404;
        access_log off;
    }

    # Route all requests to Agritech service (temporary, for Let's Encrypt setup)
    # After SSL is configured, this will redirect to HTTPS
    location / {
        proxy_pass http://127.0.0.1:5001/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # Hide security headers that only work over HTTPS (prevents browser warnings)
        proxy_hide_header Cross-Origin-Opener-Policy;
        proxy_hide_header Cross-Origin-Embedder-Policy;
        proxy_hide_header Cross-Origin-Resource-Policy;
        proxy_hide_header Strict-Transport-Security;
        
        # WebSocket support
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        
        # Timeouts
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }

    # Serve static files
    location /static/ {
        alias /var/www/html/staticfiles/;
        expires 30d;
        add_header Cache-Control "public, immutable";
        access_log off;
        try_files $uri $uri/ @backend;
        
        # Ensure proper MIME types are set
        default_type application/octet-stream;
        types {
            text/css css;
            text/javascript js;
            application/javascript js;
            application/json json;
            image/svg+xml svg;
            image/png png;
            image/jpeg jpg jpeg;
            image/gif gif;
            image/webp webp;
            font/woff woff;
            font/woff2 woff2;
            font/ttf ttf;
            font/otf otf;
        }
    }
    
    # Fallback to backend if static file not found
    location @backend {
        proxy_pass http://127.0.0.1:5001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Serve media files
    location /media/ {
        alias /var/www/html/mediafiles/;
        expires 30d;
        add_header Cache-Control "public, immutable";
        access_log off;
    }

    # Health check endpoint
    location /health {
        proxy_pass http://127.0.0.1:5001/health;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Error pages
    error_page 404 /404.html;
    error_page 500 502 503 504 /50x.html;
    
    location = /50x.html {
        root /usr/share/nginx/html;
    }
}

# ============================================================================
# Server Block 2: ESDT Subdomain - Let's Encrypt Setup
# Handles requests to esdt.jalusitech.co.za
# Routes to backend service on port 5002
# ============================================================================
server {
    listen 80;
    server_name esdt.jalusitech.co.za;

    # Allow larger uploads through the proxy
    client_max_body_size 500M;

    # Serve ACME HTTP-01 challenges from shared webroot for Let's Encrypt
    # This location MUST be present for Let's Encrypt to verify domain ownership
    location ^~ /.well-known/acme-challenge/ {
        root /var/www/certbot;
        default_type "text/plain";
        try_files $uri =404;
        access_log off;
    }

    # Route all requests to ESDT service (temporary, for Let's Encrypt setup)
    location / {
        proxy_pass http://127.0.0.1:5002/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # Hide security headers that only work over HTTPS (prevents browser warnings)
        proxy_hide_header Cross-Origin-Opener-Policy;
        proxy_hide_header Cross-Origin-Embedder-Policy;
        proxy_hide_header Cross-Origin-Resource-Policy;
        proxy_hide_header Strict-Transport-Security;
        
        # WebSocket support
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        
        # Timeouts
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }

    # Serve static files
    location /static/ {
        alias /var/www/html/staticfiles/;
        expires 30d;
        add_header Cache-Control "public, immutable";
        access_log off;
        try_files $uri $uri/ @backend;
        
        # Ensure proper MIME types are set
        default_type application/octet-stream;
        types {
            text/css css;
            text/javascript js;
            application/javascript js;
            application/json json;
            image/svg+xml svg;
            image/png png;
            image/jpeg jpg jpeg;
            image/gif gif;
            image/webp webp;
            font/woff woff;
            font/woff2 woff2;
            font/ttf ttf;
            font/otf otf;
        }
    }
    
    # Fallback to backend if static file not found
    location @backend {
        proxy_pass http://127.0.0.1:5002;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Serve media files
    location /media/ {
        alias /var/www/html/mediafiles/;
        expires 30d;
        add_header Cache-Control "public, immutable";
        access_log off;
    }

    # Health check endpoint
    location /health {
        proxy_pass http://127.0.0.1:5002/health;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Error pages
    error_page 404 /404.html;
    error_page 500 502 503 504 /50x.html;
    
    location = /50x.html {
        root /usr/share/nginx/html;
    }
}

# ============================================================================
# Server Block 3: Jalusi Beauty Booking System Subdomain - Let's Encrypt Setup
# Handles requests to jalusi-beauty.jalusitech.co.za
# Routes to backend service on port 5003
# ============================================================================
server {
    listen 80;
    server_name jalusi-beauty.jalusitech.co.za;

    # Allow larger uploads through the proxy
    client_max_body_size 500M;

    # Serve ACME HTTP-01 challenges from shared webroot for Let's Encrypt
    # This location MUST be present for Let's Encrypt to verify domain ownership
    location ^~ /.well-known/acme-challenge/ {
        root /var/www/certbot;
        default_type "text/plain";
        try_files $uri =404;
        access_log off;
    }

    # Route all requests to Jalusi Beauty service (temporary, for Let's Encrypt setup)
    location / {
        proxy_pass http://127.0.0.1:5003/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # Hide security headers that only work over HTTPS (prevents browser warnings)
        proxy_hide_header Cross-Origin-Opener-Policy;
        proxy_hide_header Cross-Origin-Embedder-Policy;
        proxy_hide_header Cross-Origin-Resource-Policy;
        proxy_hide_header Strict-Transport-Security;
        
        # WebSocket support
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        
        # Timeouts
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }

    # Serve static files
    location /static/ {
        alias /var/www/html/staticfiles/;
        expires 30d;
        add_header Cache-Control "public, immutable";
        access_log off;
        try_files $uri $uri/ @backend;
        
        # Ensure proper MIME types are set
        default_type application/octet-stream;
        types {
            text/css css;
            text/javascript js;
            application/javascript js;
            application/json json;
            image/svg+xml svg;
            image/png png;
            image/jpeg jpg jpeg;
            image/gif gif;
            image/webp webp;
            font/woff woff;
            font/woff2 woff2;
            font/ttf ttf;
            font/otf otf;
        }
    }
    
    # Fallback to backend if static file not found
    location @backend {
        proxy_pass http://127.0.0.1:5003;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Serve media files
    location /media/ {
        alias /var/www/html/mediafiles/;
        expires 30d;
        add_header Cache-Control "public, immutable";
        access_log off;
    }

    # Health check endpoint
    location /health {
        proxy_pass http://127.0.0.1:5003/health;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Error pages
    error_page 404 /404.html;
    error_page 500 502 503 504 /50x.html;
    
    location = /50x.html {
        root /usr/share/nginx/html;
    }
}

# ============================================================================
# Server Block 4: Jalusi CMS Subdomain - Let's Encrypt Setup
# Handles requests to jalusi-cms.jalusitech.co.za
# Routes to backend service on port 5004
# ============================================================================
server {
    listen 80;
    server_name jalusi-cms.jalusitech.co.za;

    # Allow larger uploads through the proxy
    client_max_body_size 500M;

    # Serve ACME HTTP-01 challenges from shared webroot for Let's Encrypt
    # This location MUST be present for Let's Encrypt to verify domain ownership
    location ^~ /.well-known/acme-challenge/ {
        root /var/www/certbot;
        default_type "text/plain";
        try_files $uri =404;
        access_log off;
    }

    # Route all requests to Jalusi CMS service (temporary, for Let's Encrypt setup)
    location / {
        proxy_pass http://127.0.0.1:5004/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # Hide security headers that only work over HTTPS (prevents browser warnings)
        proxy_hide_header Cross-Origin-Opener-Policy;
        proxy_hide_header Cross-Origin-Embedder-Policy;
        proxy_hide_header Cross-Origin-Resource-Policy;
        proxy_hide_header Strict-Transport-Security;
        
        # WebSocket support
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        
        # Timeouts
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }

    # Serve static files
    location /static/ {
        alias /var/www/html/staticfiles/;
        expires 30d;
        add_header Cache-Control "public, immutable";
        access_log off;
        try_files $uri $uri/ @backend;
        
        # Ensure proper MIME types are set
        default_type application/octet-stream;
        types {
            text/css css;
            text/javascript js;
            application/javascript js;
            application/json json;
            image/svg+xml svg;
            image/png png;
            image/jpeg jpg jpeg;
            image/gif gif;
            image/webp webp;
            font/woff woff;
            font/woff2 woff2;
            font/ttf ttf;
            font/otf otf;
        }
    }
    
    # Fallback to backend if static file not found
    location @backend {
        proxy_pass http://127.0.0.1:5004;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Serve media files
    location /media/ {
        alias /var/www/html/mediafiles/;
        expires 30d;
        add_header Cache-Control "public, immutable";
        access_log off;
    }

    # Health check endpoint
    location /health {
        proxy_pass http://127.0.0.1:5004/health;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Error pages
    error_page 404 /404.html;
    error_page 500 502 503 504 /50x.html;
    
    location = /50x.html {
        root /usr/share/nginx/html;
    }
}

# ============================================================================
# Server Block 5: Jalusi Tech Subdomain - Let's Encrypt Setup
# Handles requests to jalusi-tech.jalusitech.co.za
# Routes to backend service on port 5005
# ============================================================================
server {
    listen 80;
    server_name jalusi-tech.jalusitech.co.za;

    # Allow larger uploads through the proxy
    client_max_body_size 500M;

    # Serve ACME HTTP-01 challenges from shared webroot for Let's Encrypt
    # This location MUST be present for Let's Encrypt to verify domain ownership
    location ^~ /.well-known/acme-challenge/ {
        root /var/www/certbot;
        default_type "text/plain";
        try_files $uri =404;
        access_log off;
    }

    # Route all requests to Jalusi Tech service (temporary, for Let's Encrypt setup)
    location / {
        proxy_pass http://127.0.0.1:5005/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # Hide security headers that only work over HTTPS (prevents browser warnings)
        proxy_hide_header Cross-Origin-Opener-Policy;
        proxy_hide_header Cross-Origin-Embedder-Policy;
        proxy_hide_header Cross-Origin-Resource-Policy;
        proxy_hide_header Strict-Transport-Security;
        
        # WebSocket support
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        
        # Timeouts
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }

    # Serve static files
    location /static/ {
        alias /var/www/html/staticfiles/;
        expires 30d;
        add_header Cache-Control "public, immutable";
        access_log off;
        try_files $uri $uri/ @backend;
        
        # Ensure proper MIME types are set
        default_type application/octet-stream;
        types {
            text/css css;
            text/javascript js;
            application/javascript js;
            application/json json;
            image/svg+xml svg;
            image/png png;
            image/jpeg jpg jpeg;
            image/gif gif;
            image/webp webp;
            font/woff woff;
            font/woff2 woff2;
            font/ttf ttf;
            font/otf otf;
        }
    }
    
    # Fallback to backend if static file not found
    location @backend {
        proxy_pass http://127.0.0.1:5005;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Serve media files
    location /media/ {
        alias /var/www/html/mediafiles/;
        expires 30d;
        add_header Cache-Control "public, immutable";
        access_log off;
    }

    # Health check endpoint
    location /health {
        proxy_pass http://127.0.0.1:5005/health;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Error pages
    error_page 404 /404.html;
    error_page 500 502 503 504 /50x.html;
    
    location = /50x.html {
        root /usr/share/nginx/html;
    }
}

# ============================================================================
# Server Block 6: Mzansi Serve Subdomain - Let's Encrypt Setup
# Handles requests to mzansi-serve.jalusitech.co.za
# Routes to backend service on port 5006
# ============================================================================
server {
    listen 80;
    server_name mzansi-serve.jalusitech.co.za;

    # Allow larger uploads through the proxy
    client_max_body_size 500M;

    # Serve ACME HTTP-01 challenges from shared webroot for Let's Encrypt
    # This location MUST be present for Let's Encrypt to verify domain ownership
    location ^~ /.well-known/acme-challenge/ {
        root /var/www/certbot;
        default_type "text/plain";
        try_files $uri =404;
        access_log off;
    }

    # Route all requests to Mzansi Serve service (temporary, for Let's Encrypt setup)
    location / {
        proxy_pass http://127.0.0.1:5006/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # Hide security headers that only work over HTTPS (prevents browser warnings)
        proxy_hide_header Cross-Origin-Opener-Policy;
        proxy_hide_header Cross-Origin-Embedder-Policy;
        proxy_hide_header Cross-Origin-Resource-Policy;
        proxy_hide_header Strict-Transport-Security;
        
        # WebSocket support
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        
        # Timeouts
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }

    # Serve static files
    location /static/ {
        alias /var/www/html/staticfiles/;
        expires 30d;
        add_header Cache-Control "public, immutable";
        access_log off;
        try_files $uri $uri/ @backend;
        
        # Ensure proper MIME types are set
        default_type application/octet-stream;
        types {
            text/css css;
            text/javascript js;
            application/javascript js;
            application/json json;
            image/svg+xml svg;
            image/png png;
            image/jpeg jpg jpeg;
            image/gif gif;
            image/webp webp;
            font/woff woff;
            font/woff2 woff2;
            font/ttf ttf;
            font/otf otf;
        }
    }
    
    # Fallback to backend if static file not found
    location @backend {
        proxy_pass http://127.0.0.1:5006;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Serve media files
    location /media/ {
        alias /var/www/html/mediafiles/;
        expires 30d;
        add_header Cache-Control "public, immutable";
        access_log off;
    }

    # Health check endpoint
    location /health {
        proxy_pass http://127.0.0.1:5006/health;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Error pages
    error_page 404 /404.html;
    error_page 500 502 503 504 /50x.html;
    
    location = /50x.html {
        root /usr/share/nginx/html;
    }
}

# ============================================================================
# Default Server Block: Catch-all for unmatched domains
# ============================================================================
server {
    listen 80 default_server;
    server_name _;

    # Allow larger uploads through the proxy
    client_max_body_size 500M;

    # Serve ACME HTTP-01 challenges (for any unmatched domain)
    location ^~ /.well-known/acme-challenge/ {
        root /var/www/certbot;
        default_type "text/plain";
        try_files $uri =404;
        access_log off;
    }

    # Default service at root path (routes to Agritech service on port 5001)
    location / {
        proxy_pass http://127.0.0.1:5001/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # Hide security headers that only work over HTTPS (prevents browser warnings)
        proxy_hide_header Cross-Origin-Opener-Policy;
        proxy_hide_header Cross-Origin-Embedder-Policy;
        proxy_hide_header Cross-Origin-Resource-Policy;
        proxy_hide_header Strict-Transport-Security;
        
        # WebSocket support
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        
        # Timeouts
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }

    # Serve static files
    location /static/ {
        alias /var/www/html/staticfiles/;
        expires 30d;
        add_header Cache-Control "public, immutable";
        access_log off;
        try_files $uri $uri/ @backend;
        
        # Ensure proper MIME types are set
        default_type application/octet-stream;
        types {
            text/css css;
            text/javascript js;
            application/javascript js;
            application/json json;
            image/svg+xml svg;
            image/png png;
            image/jpeg jpg jpeg;
            image/gif gif;
            image/webp webp;
            font/woff woff;
            font/woff2 woff2;
            font/ttf ttf;
            font/otf otf;
        }
    }
    
    # Fallback to backend if static file not found
    location @backend {
        proxy_pass http://127.0.0.1:5001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Serve media files
    location /media/ {
        alias /var/www/html/mediafiles/;
        expires 30d;
        add_header Cache-Control "public, immutable";
        access_log off;
    }

    # Health check endpoint
    location /health {
        proxy_pass http://127.0.0.1:5001/health;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Error pages
    error_page 404 /404.html;
    error_page 500 502 503 504 /50x.html;
    
    location = /50x.html {
        root /usr/share/nginx/html;
    }
}

# ============================================================================
# Configuration Notes for Let's Encrypt Setup:
# ============================================================================
# Subdomain Routing:
# - agritech.jalusitech.co.za -> http://127.0.0.1:5001/ (Agritech service)
# - esdt.jalusitech.co.za -> http://127.0.0.1:5002/ (ESDT service)
# - jalusi-beauty.jalusitech.co.za -> http://127.0.0.1:5003/ (Jalusi Beauty service)
# - jalusi-cms.jalusitech.co.za -> http://127.0.0.1:5004/ (Jalusi CMS service)
# - jalusi-tech.jalusitech.co.za -> http://127.0.0.1:5005/ (Jalusi Tech service)
# - mzansi-serve.jalusitech.co.za -> http://127.0.0.1:5006/ (Mzansi Serve service)
#
# DNS Requirements:
# - Ensure DNS A records are configured for all subdomains pointing to server IP
# - Each subdomain should have an A record pointing to the server IP address
#
# Let's Encrypt Setup:
# 1. Ensure /var/www/certbot directory exists and is writable by nginx
# 2. This configuration allows Let's Encrypt to verify domain ownership via HTTP-01 challenge
# 3. The ACME challenge location is critical and must be accessible at /.well-known/acme-challenge/
# 4. After obtaining SSL certificates, switch to nginx_https.conf
#
# Certificate Generation:
# To obtain certificates for each subdomain, run:

# Installing certbot on Amazon Linux 2023. Providing commands:
# sudo dnf install certbot -y
# Certbot is installed. Verifying it works and creating the webroot directory if needed:
# certbot --version
# sudo mkdir -p /var/www/certbot && sudo chown $USER:$USER /var/www/certbot 2>/dev/null || sudo mkdir -p /var/www/certbot
# Once Certbot is installed (version 2.6.0). Use:
# sudo certbot certonly --webroot -w /var/www/certbot -d agritech.jalusitech.co.za
# sudo certbot certonly --webroot -w /var/www/certbot -d esdt.jalusitech.co.za
# sudo certbot certonly --webroot -w /var/www/certbot -d jalusi-beauty.jalusitech.co.za
# sudo certbot certonly --webroot -w /var/www/certbot -d jalusi-cms.jalusitech.co.za
# sudo certbot certonly --webroot -w /var/www/certbot -d jalusi-tech.jalusitech.co.za
# sudo certbot certonly --webroot -w /var/www/certbot -d mzansi-serve.jalusitech.co.za
#
# Or use a wildcard certificate for all subdomains:
# sudo certbot certonly --webroot -w /var/www/certbot -d *.jalusitech.co.za -d jalusitech.co.za
#
# To enable automatic renewals:
# sudo systemctl start certbot-renew.timer
# sudo systemctl enable certbot-renew.timer
#
# To check the status of the timer:
# sudo systemctl status certbot-renew.timer
#
# To check the logs of the timer:
# sudo journalctl -u certbot-renew.timer
#
# To check the logs of the certbot:
# Configuration:
# 1. Each subdomain has its own server block with dedicated routing
# 2. Port numbers (5001-5006) match the HTTP configuration
# 3. Static and media file paths are consistent across all subdomains
# 4. Health check endpoints use the same port as the main service
# 5. Security headers (COOP, COEP, CORP, HSTS) are hidden over HTTP to prevent browser warnings
# 6. After certificates are obtained, update nginx_https.conf with certificate paths
# 7. Default server block routes unmatched domains to Agritech service (port 5001)
#
# Next Steps:
# - After certificates are obtained, nginx_https.conf already has certificate paths configured:
#   - agritech.jalusitech.co.za
#   - esdt.jalusitech.co.za
#   - jalusi-beauty.jalusitech.co.za
#   - jalusi-cms.jalusitech.co.za
#   - jalusi-tech.jalusitech.co.za
#   - mzansi-serve.jalusitech.co.za
# - Test certificate renewal: certbot renew --webroot -w /var/www/certbot
# ============================================================================
